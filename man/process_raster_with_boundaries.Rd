% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/process_raster_collection.R
\name{process_raster_with_boundaries}
\alias{process_raster_with_boundaries}
\title{Process raster data with administrative boundaries}
\usage{
process_raster_with_boundaries(
  raster_file,
  shapefile,
  id_cols = c("adm0", "adm1"),
  aggregations = c("mean"),
  raster_is_density = FALSE
)
}
\arguments{
\item{raster_file}{Path to raster file (.tif format)}

\item{shapefile}{sf/SpatVector object with administrative boundaries. Must be
in the same coordinate reference system (CRS) as the raster data}

\item{id_cols}{Vector of column names from the shapefile to include in
output. Default is c("adm0", "adm1") for country and first admin level}

\item{aggregations}{Vector of aggregation methods to calculate. Supported
values are "mean", "sum", and "median". Default is c("mean")}

\item{raster_is_density}{Logical indicating if raster values represent density.
If TRUE, values are converted from density to counts using cell area.
Default is FALSE.}
}
\value{
A data frame containing:
\itemize{
\item file_name: Name of processed raster file
\item Selected ID columns from shapefile (specified by id_cols)
\item Time columns based on detected pattern:
- For monthly data: year, month
- For yearly data: year
\item Aggregated values with column names matching aggregation methods
}
}
\description{
This function processes a single raster file by extracting zonal statistics
within administrative boundaries. It handles CHIRPS rainfall data format by
default, extracting dates from filenames, but works with any raster data.
}
\details{
The function performs the following steps:
\enumerate{
\item Validates requested aggregation methods
\item Detects and extracts date information from filename
\item Loads raster data and handles no-data values (-9999)
\item If raster_is_density is TRUE, converts density to counts using cell area
\item Calculates zonal statistics using exactextractr
\item Combines results with shapefile attributes
\item Returns a clean data frame without geometry
}
}
\examples{
\dontrun{
# Process single CHIRPS file with district-level boundaries
districts <- sf::st_read("districts.shp")
results <- process_raster_with_boundaries(
  raster_file = "chirps-v2.0.2022.01.tif",
  shapefile = districts,
  id_cols = c("COUNTRY", "DISTRICT"),
  aggregations = c("mean", "sum", "median")
)
}
}
