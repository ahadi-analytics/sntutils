% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/download_who_shapefile.R
\name{download_shapefile}
\alias{download_shapefile}
\title{Download WHO Administrative Boundaries with Partial Update}
\usage{
download_shapefile(
  country_codes,
  admin_level = "ADM2",
  latest = TRUE,
  dest_file = NULL
)
}
\arguments{
\item{country_codes}{Character vector of ISO3 country codes
(e.g. c("KEN","UGA")).}

\item{admin_level}{Character string specifying administrative level
("ADM0", "ADM1", or "ADM2"). Default is "ADM2".}

\item{latest}{Logical. If TRUE (default), returns only the latest/active
boundaries. If FALSE, returns all historical boundaries.}

\item{dest_file}{File path where data is saved. If NULL (default),
data is returned without saving to disk.}
}
\value{
An \code{sf} object containing administrative boundaries with the
following columns:
\describe{
\item{adm0_code}{ISO3 country code}
\item{adm0}{Country name}
\item{adm1}{Admin level 1 name (regions/states) - only for ADM1 and ADM2}
\item{adm2}{Admin level 2 name (districts) - only for ADM2}
\item{start_date}{Date when the boundary became effective}
\item{end_date}{Date when the boundary ceased (9999-12-31 for current)}
\item{geometry}{Spatial geometry column}
}
If \code{dest_file} is provided, the data is also saved to that location.
}
\description{
Downloads administrative boundaries from WHO's ArcGIS services for specified
countries and administrative levels. The function supports incremental
updates, downloading only missing data when appending to existing files. It
automatically converts date fields from milliseconds to proper Date format
and can filter for current boundaries or include historical boundaries.
}
\details{
The function retrieves boundary data from WHO's Global Administrative
Boundaries service hosted on ArcGIS. It uses the httr2 package for API
requests and sf for spatial data handling. Date fields are automatically
converted from milliseconds since epoch to R Date objects.

When \code{latest = TRUE} (default), only active boundaries are returned (those
with ENDDATE of 9999-12-31). When \code{latest = FALSE}, all historical boundaries
are included, useful for tracking boundary changes over time (e.g., country
splits or administrative reorganizations).

The incremental update feature checks existing files for already downloaded
countries and only fetches missing ones, making it efficient for building
large boundary datasets.
}
\note{
Requires the \code{httr2} package for API requests. Install with:
\code{install.packages("httr2")}
}
\examples{

\donttest{

tf <- file.path(tempdir(), "test_env")

# Download latest ADM2 boundaries without saving to disk
kenya_districts <- download_shapefile(
  country_codes = "KEN",
  admin_level = "ADM2",
  latest = TRUE  # Only current boundaries
)

# Download all historical boundaries (e.g., to track boundary changes)
sudan_historical <- download_shapefile(
  country_codes = "SDN",
  admin_level = "ADM0",
  latest = FALSE  # Include historical boundaries
)
# This would show Sudan before and after South Sudan independence
# (2011-07-11)

# Download multiple countries and save to file
# File will be saved as "east_africa_adm0.gpkg"
africa_countries <- download_shapefile(
  country_codes = c("KEN", "UGA", "TZA"),
  admin_level = "ADM0",
  dest_file = here::here(tf, "east_africa.gpkg")
)

# Incremental update - add more countries to existing file
# Will use the same "east_africa_adm0.gpkg" file
download_shapefile(
  country_codes = c("KEN", "UGA", "TZA", "RWA", "BDI"),
  admin_level = "ADM0",
  dest_file = here::here(tf, "east_africa.gpkg")
)
# Only RWA and BDI will be downloaded and appended

# Different admin levels saved to different files
# Saves as "kenya_boundaries_adm1.gpkg"
download_shapefile("KEN", "ADM1",
                   dest_file = here::here(tf, "kenya_boundaries.gpkg"))
# Saves as "kenya_boundaries_adm2.gpkg"
download_shapefile("KEN", "ADM2",
                   dest_file = here::here(tf, "kenya_boundaries.gpkg"))
}

}
\seealso{
\code{\link[sf]{st_read}} for reading spatial data,
\code{\link[sf]{st_write}} for writing spatial data.
WHO boundary services: \url{https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services}
}
