% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/reporting_rate.R
\name{prepare_plot_data}
\alias{prepare_plot_data}
\title{Prepare data for reporting rate or missing data visualization}
\usage{
prepare_plot_data(
  data,
  x_var,
  y_var = NULL,
  vars_of_interest,
  by_facility = FALSE,
  hf_col = NULL,
  use_reprate = TRUE,
  key_indicators = c("allout", "conf", "test", "treat", "pres"),
  weighting = FALSE,
  weight_var = NULL,
  weight_window = 12,
  exclude_current_x = TRUE,
  cold_start = "median_within_y"
)
}
\arguments{
\item{data}{Original data frame}

\item{x_var}{Character. Time variable (e.g. yearmon)}

\item{y_var}{Character. Optional grouping variable (e.g. district)}

\item{vars_of_interest}{Character vector of variables to analyze}

\item{by_facility}{Logical. If TRUE, compute by facility}

\item{hf_col}{Character. Name of health facility ID column (required
if by_facility)}

\item{use_reprate}{Logical. If TRUE, return reporting rate. Else, missing
rate}

\item{key_indicators}{Optional. Character vector of indicators used to define
facility activity in scenario 1. Defaults to
\code{c("allout", "conf", "test", "treat", "pres")}.}

\item{weighting}{Logical. Whether to use weighted reporting rates. When TRUE,
facilities are weighted by their typical size, giving more importance to
larger facilities in the overall reporting rate calculation. Default is FALSE.}

\item{weight_var}{Character. Name of the variable to use as proxy for
facility size (e.g., "allout" for total outpatients). Required when
weighting is TRUE. Default is NULL.}

\item{weight_window}{Integer. Number of periods for rolling window to
calculate typical facility size. Default is 12.}

\item{exclude_current_x}{Logical. Whether to exclude current period when
calculating weights. If TRUE, prevents current reporting from influencing
its own weight. Default is TRUE.}

\item{cold_start}{Character. Method for handling facilities with insufficient
history. Options: "median_within_y" (default) or "median_global".}
}
\value{
A list with plot_data and plotting metadata
}
\description{
This function processes health facility data to prepare it for visualizing
reporting rates or missing data patterns. It supports three scenarios:
\enumerate{
\item reporting rate by time and admin unit (x + y, single var)
\item missing rate by variable over time (x only, multiple vars)
\item proportion of facilities reporting in each (x, y) group (needs hf)
}
}
\examples{
# Sample data
hf_data <- data.frame(
  month = rep(c("Jan", "Feb", "Mar"), each = 10),
  district = rep(c("North", "South"), each = 5, times = 3),
  facility_id = rep(1:5, times = 6),
  malaria = c(
    10, 0, 15, NA, 8, 12, 0, NA, 7, 9,
    11, 0, 14, 6, NA, 13, 8, 10, 0, 12,
    9, 7, 0, 11, 14, 8, NA, 12, 10, 15
  ),
  pneumonia = c(
    5, 0, NA, 7, 3, 6, 0, 4, NA, 2,
    8, 0, 6, NA, 4, 7, 3, 0, 5, 6,
    4, 0, 7, 5, NA, 6, 0, 8, 4, 3
  )
)

# Scenario 1: Reporting rate by district and month for each variable
district_plot_data <- prepare_plot_data(
  data = hf_data,
  x_var = "month",
  y_var = "district",
  vars_of_interest = c("malaria", "pneumonia"),
  use_reprate = TRUE
)
# Returns list with plot_data and metadata for district-level visualization

# Scenario 2: Missing rate of variables over time (months only)
variable_plot_data <- prepare_plot_data(
  data = hf_data,
  x_var = "month",
  vars_of_interest = c("malaria", "pneumonia"),
  use_reprate = FALSE
)
# Returns list with plot_data and metadata for variable-level visualization

# Scenario 3: Proportion of facilities reporting in each district by month
facility_plot_data <- prepare_plot_data(
  data = hf_data,
  x_var = "month",
  y_var = "district",
  vars_of_interest = "malaria",
  by_facility = TRUE,
  hf_col = "facility_id"
)
# Returns list with plot_data and metadata for facility-level visualization
}
