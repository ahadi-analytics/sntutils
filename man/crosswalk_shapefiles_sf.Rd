% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/crosswalk_shapefiles.R
\name{crosswalk_shapefiles_sf}
\alias{crosswalk_shapefiles_sf}
\title{Create an area-weighted crosswalk between old and new admin polygons}
\usage{
crosswalk_shapefiles_sf(
  old_sf,
  new_sf,
  level = c("adm0", "adm1", "adm2"),
  old_suffix = "_old",
  min_weight = 0.001,
  area_crs = 32735,
  keep_overlap_geometry = FALSE,
  min_primary_weight = 0.5,
  min_secondary_weight = 0.1,
  coverage_tol = 0.05,
  verbose = TRUE,
  include_areas = FALSE,
  include_reverse_prop = FALSE
)
}
\arguments{
\item{old_sf}{sf object. Old administrative boundaries.
Must contain columns adm0, adm1, adm2 and be in EPSG:4326.}

\item{new_sf}{sf object. New administrative boundaries.
Must contain columns adm0, adm1, adm2 and be in EPSG:4326.}

\item{level}{character. One of "adm0", "adm1", "adm2".
Determines which administrative level is crosswalked.}

\item{old_suffix}{character. Suffix appended to old admin names.}

\item{min_weight}{numeric. Minimum old-to-new area proportion to retain.}

\item{area_crs}{integer. EPSG code for a planar equal-area CRS.}

\item{keep_overlap_geometry}{logical. If TRUE, include overlap geometries.}

\item{min_primary_weight}{numeric. Minimum weight to label as primary.}

\item{min_secondary_weight}{numeric. Minimum weight for secondary overlaps.}

\item{coverage_tol}{numeric. Tolerance for area coverage diagnostics.}

\item{verbose}{logical. If TRUE, print CLI progress messages.}

\item{include_areas}{logical. If TRUE, include area columns in km2.}

\item{include_reverse_prop}{logical. If TRUE, include new-to-old proportion.

Outputs
Returns a list with:
\itemize{
\item data: data.frame with crosswalk mappings and diagnostics
\item dictionary: data.frame describing each column
\item metadata: data.frame with run parameters and timestamps
\item overlap_geometry: (if keep_overlap_geometry = TRUE) sf object
}

Key columns in data output
\itemize{
\item overlap_prop: proportion of old unit area overlapping new unit
\item is_primary: TRUE if dominant mapping for old unit (overlap_prop >= 0.5)
\item n_new_adm: number of new units overlapping the old unit
\item split_flag: TRUE if old unit overlaps multiple new units
\item n_old_per_new: number of old units overlapping the new unit
\item merge_flag: TRUE if multiple old units merged into new unit
}

Assumptions
\itemize{
\item Areas are computed in a planar CRS.
\item Attributes (admin names) are spatially constant within polygons.
\item Weights are area-based, not population-weighted.
}}
}
\description{
Purpose
This function constructs a reproducible lookup table linking old and new
administrative boundary systems using polygon overlap. It is designed to
handle boundary splits and merges explicitly and to support backcasting or
forward aggregation of indicators across administrative changes.
}
\details{
Weights are area-based and assume uniform distribution within polygons.
All geometric operations are performed in a planar equal-area CRS.

Inputs
}
\examples{
\dontrun{
cw_adm2 <- crosswalk_shapefiles_sf(
  old_sf = adm2_old,
  new_sf = adm2_new,
  level = "adm2",
  min_weight = 0.001,
  area_crs = 32735
)
}
}
