% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/outlier_correction.R
\name{correct_outliers}
\alias{correct_outliers}
\title{Correct outliers using temporal neighbors}
\usage{
correct_outliers(
  data,
  target_vars,
  consistency_vars,
  outlier_flag_col = "outlier_flag_consensus",
  group_cols,
  date_col = "date",
  verbose = TRUE
)
}
\arguments{
\item{data}{Data frame containing outlier flags and variables to correct.}

\item{target_vars}{Character vector. Columns to correct (e.g., c("conf",
"maltreat")). Each target is paired with the corresponding element in
\code{consistency_vars}.}

\item{consistency_vars}{Character vector. Upper bound columns (e.g.,
c("test", "conf")). Must be the same length as \code{target_vars}. For each
pair, the corrected value must be <= consistency variable.}

\item{outlier_flag_col}{Character. Column containing outlier flags. Values
of "outlier" are corrected. Default: "outlier_flag_consensus".}

\item{group_cols}{Character vector. Columns defining the time series groups
(e.g., c("hf_uid") for facility-level). Neighbors are found within groups.}

\item{date_col}{Character. Date column name. Default: "date".}

\item{verbose}{Logical. Print summary messages. Default: TRUE.}
}
\value{
The input data frame with two new columns per target variable:
\describe{
\item{\code{{target}_corrected}}{The corrected value, or original if no
correction was applied.
}
\item{\code{{target}_correction_flag}}{Reason for correction status:
"corrected", "failed_consistency", "missing_neighbors", or "not_outlier".
}
}
}
\description{
Corrects outlier values by replacing them with the median of neighboring
months (month before and month after). Applies a consistency rule to ensure
corrected values do not exceed an upper bound variable.
}
\details{
For each target variable flagged as an outlier:
\enumerate{
\item Retrieve the value from the month before (lag) and month after (lead)
\item If either neighbor is missing, no correction is applied
\item Compute the median of the two neighbors
\item Check if the median exceeds the consistency variable for that row
\item If the consistency check fails, the corrected value is set to NA
\item Otherwise, replace the outlier with the median
}
}
\examples{
\dontrun{
# After running detect_outliers()
result <- detect_outliers(data, column = "conf", ...)

# Correct single variable: conf bounded by test
corrected <- correct_outliers(
  data = result,
  target_vars = "conf",
  consistency_vars = "test",
  group_cols = c("hf_uid"),
  date_col = "date"
)

# Correct multiple variables at once
corrected <- correct_outliers(
  data = result,
  target_vars = c("conf", "maltreat", "maladm"),
  consistency_vars = c("test", "conf", "conf"),
  group_cols = c("hf_uid"),
  date_col = "date"
)
}

}
