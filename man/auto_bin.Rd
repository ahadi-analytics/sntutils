% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/auto_bin.R
\name{auto_bin}
\alias{auto_bin}
\title{Automatically bin numeric data for choropleth maps}
\usage{
auto_bin(
  x,
  palette = "default",
  bin = 6,
  decimals = 2,
  round_to = 50,
  reverse = FALSE,
  labels = NULL,
  outlier_threshold = NULL,
  outlier_color = "#636363"
)
}
\arguments{
\item{x}{Numeric vector to bin.}

\item{palette}{Character. Either a preset name or a custom character vector
of hex colors. Use \code{list_palettes()} to see available presets.}

\item{bin}{Integer. Number of bins. Default is 6.}

\item{decimals}{Integer. Number of decimal places in labels. Default is 2.}

\item{round_to}{Numeric. Round break points to this increment. Default is 50.
Set to NULL for raw values (useful for decimal data like rates).}

\item{reverse}{Logical. Reverse the color order? Default is FALSE.}

\item{labels}{Character vector. Optional custom bin labels. When provided,
skips automatic binning and uses these labels with breaks parsed from
label strings. Supports formats: "0–50", "50-100", ">1000". Example:
c("0–50", "50–100", "100–250", "250–450", "450–700", "700–1000", ">1000")}

\item{outlier_threshold}{Numeric. Optional threshold to create a separate
outlier bin for values above this threshold. Useful for metrics like TPR
where values >1 are unusual. Default is NULL (no outlier handling).}

\item{outlier_color}{Character. Hex color for the outlier bin. Only used
when outlier_threshold is specified. Default is "#636363" (dark grey).}
}
\value{
A list with:
\item{bins}{Ordered factor of bin labels for each value in \code{x}}
\item{colors}{Named character vector mapping labels to colors}
\item{counts}{Data frame with bin labels and counts (n)}
\item{method}{Character. The binning method used: "headtail", "hybrid",
"quantile", or "custom"}
\item{diagnostics}{List with prop_zero, skew_ratio, and tail_share}
}
\description{
Selects an appropriate binning method based on data distribution and
returns bins with matching colors. Three methods are available: head-tail
breaks for highly skewed data, hybrid (quantile + tail) for moderately
skewed data, and pure quantile for roughly symmetric data.
}
\details{
Method selection logic:
\itemize{
\item \strong{headtail}: prop_zero > 0.1, skew_ratio > 4, or tail_share > 0.4
\item \strong{hybrid}: skew_ratio > 2
\item \strong{quantile}: otherwise
\item \strong{custom}: when labels parameter is provided
}

Use \code{list_palettes()} to see all available palette names.
}
\examples{
# Simulated malaria incidence data
set.seed(42)
incidence <- c(rep(0, 20), rgamma(80, shape = 2, rate = 0.01))

result <- auto_bin(incidence)
table(result$bins)
result$method
result$colors

# Use named palette
auto_bin(incidence, palette = "byor")$colors

# Use custom palette
auto_bin(incidence, palette = c("#ffffcc", "#a1dab4", "#41b6c4", "#225ea8"))

# Reverse colors (high = light, low = dark)
auto_bin(incidence, reverse = TRUE)$colors

# Use custom labels
custom_labels <- c("0–50", "50–100", "100–250", "250–450",
                   "450–700", "700–1000", ">1000")
result <- auto_bin(incidence * 10, palette = "byor", labels = custom_labels)
table(result$bins)
result$method  # Returns "custom"

# Handle outliers above threshold (useful for TPR)
set.seed(123)
tpr <- c(runif(80, 0.5, 0.95), runif(20, 1.05, 1.3))
result <- auto_bin(tpr, palette = "rdbu", bin = 5, outlier_threshold = 1.0)
table(result$bins)
result$colors  # Last bin (>1.00) will be grey

}
