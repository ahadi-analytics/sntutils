% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/facility_reporting_plot.R
\name{classify_facility_activity}
\alias{classify_facility_activity}
\title{Classify health facility activity status by reporting behaviour}
\usage{
classify_facility_activity(
  data,
  hf_col,
  date_col = "date",
  key_indicators = c("test", "pres", "conf"),
  method = "method1",
  nonreport_window = 6,
  reporting_rule = "any_non_na",
  binary_classification = FALSE
)
}
\arguments{
\item{data}{Data frame containing routine health facility records.}

\item{hf_col}{Character. Column storing health facility identifiers.}

\item{date_col}{Character. Column storing observation dates. Defaults to
"date".}

\item{key_indicators}{Character vector with columns defining reporting
activity. Defaults to \code{c("test", "pres", "conf")}.}

\item{method}{Character. One of \code{"method1"}, \code{"method2"}, \code{"method3"}, or
\code{"all"}. See Details. Defaults to \code{"method1"}.}

\item{nonreport_window}{Integer. Minimum number of consecutive non-reporting
months to classify a facility as inactive in method 3. Defaults to 6.}

\item{reporting_rule}{Character. Defines what counts as reporting:
\code{"any_non_na"} (default, counts NA as non-reporting, 0 counts as reported)
or \code{"positive_only"} (requires >0 value to count as reported).}

\item{binary_classification}{Logical. If TRUE, collapses categories into
"Active" vs "Inactive". Defaults to FALSE.}
}
\value{
Data frame with original columns plus reporting and activity status.
If \code{method = "all"}, includes all three activity classification columns.
}
\description{
Builds a balanced monthly panel for all facilities and months, flags
reporting on key indicators, and classifies each facility-month into
activity status according to one of three methods.
}
\details{
Three activity classification methods are supported:
\itemize{
\item \strong{Method 1 (Permanent activation):} Facility is active from first
report onwards, remains active afterwards.
\item \strong{Method 2 (Firstâ€“Last activation):} Facility is active only between
first and last report dates.
\item \strong{Method 3 (Dynamic):} Facility is active, but becomes inactive if
it misses \code{nonreport_window} consecutive months. Reactivates if reporting
resumes.
}

The \code{reporting_rule} parameter controls how reporting is flagged:
\itemize{
\item \code{"any_non_na"}: Any non-missing value counts as reported (including 0).
\item \code{"positive_only"}: Only values strictly >0 count as reported.
}
}
\examples{
toy_data <- tibble::tibble(
  hf_uid = rep(c("HF1", "HF2"), each = 6),
  date = rep(
    seq(as.Date("2024-01-01"), by = "month", length.out = 6),
    2
  ),
  test = c(NA, 1, 0, 0, NA, 0,  NA, NA, 0, 1, 0, 0),
  pres = c(NA, 0, 1, NA, NA, 0,  0, NA, NA, 0, 1, NA),
  conf = c(NA, 0, NA, 1, 0, NA,  0, 0, NA, NA, 0, 1)
)

classified <- classify_facility_activity(
  data = toy_data,
  hf_col = "hf_uid",
  key_indicators = c("test", "pres", "conf"),
  method = "all",
  nonreport_window = 2,
  reporting_rule = "any_non_na"
)

dplyr::count(classified, activity_status_method1)

}
